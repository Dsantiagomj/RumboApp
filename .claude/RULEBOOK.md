# Rumbo - RULEBOOK

_Last Updated: January 11, 2026 (Production-Grade Update)_
_Generated by Maestro Mode - Claude Code Agents Toolkit_
_Philosophy: Zero Shortcuts - Build it RIGHT from day one ğŸ’ª_

---

## ğŸ“‹ Project Summary

**Project Name:** Rumbo
**Type:** AI-Powered Life Assistant - Personal Finance Application
**Primary Language:** TypeScript 5.9.3 (strict mode)
**Description:** Rumbo is an AI-powered life assistant that helps you navigate your financial journey and life goals with intelligent guidance, starting with those who need it most. Transforms financial stress into financial clarity through pattern learning, needs prediction, and actionable recommendations. Initially focused on Colombian context (COP, es-CO, local stores).

**Current Version:** v1 Skateboard (Foundation - Personal Finance Tool)
**Context:** Colombia (BogotÃ¡, MedellÃ­n, Cali) - Economic pressure, tight budgets

---

## ğŸ“š RULEBOOK Structure

This RULEBOOK is modular - detailed rules are in reference documents to keep this file manageable.

### Core Reference Documents

1. **[CODE_STANDARDS.md](../.rumbo/CODE_STANDARDS.md)** â­ **MANDATORY**
   - Folder architecture (feature-based)
   - File naming conventions (kebab-case)
   - Import/export patterns (named exports, strategic barrels)
   - Component structure (folder-based, types separation)
   - TypeScript patterns (interface vs type)
   - tRPC & API patterns
   - Testing organization
   - Code style & formatting
   - **READ THIS FIRST** before writing ANY code

2. **[TECH_STACK.md](../.rumbo/TECH_STACK.md)**
   - Complete technology decisions
   - Framework versions and rationale
   - Hosting strategy
   - Development workflow

3. **[TECHNICAL_REQUIREMENTS.md](../.rumbo/TECHNICAL_REQUIREMENTS.md)**
   - Performance requirements
   - Security requirements
   - Accessibility requirements
   - Testing requirements

4. **[SCOPE.md](../.rumbo/SCOPE.md)**
   - Project roadmap (v1-v5)
   - Feature priorities
   - Success criteria

---

## ğŸ› ï¸ Tech Stack (Quick Reference)

**Full details in:** [.rumbo/TECH_STACK.md](../.rumbo/TECH_STACK.md)

### Frontend

- **Framework:** Next.js 16.1+ (App Router, Turbopack)
- **React:** 19.2.3+ (Server Components)
- **Language:** TypeScript 5.9.3 (strict mode)
- **Styles:** Tailwind CSS 4.1
- **Components:** Shadcn/ui + Storybook 8+
- **Animations:** Framer Motion
- **Data:** tRPC 11 + TanStack Query 5

### Backend

- **API:** tRPC 11 (end-to-end type safety)
- **Database:** PostgreSQL 16 (self-hosted Docker + PgBouncer)
- **ORM:** Prisma 7.2+
- **Auth:** NextAuth.js 5 + Argon2
- **Jobs:** BullMQ + Redis

### Testing (Production-Grade)

- **Unit:** Vitest
- **Component:** Storybook
- **E2E:** Playwright
- **Coverage:** 80%+ general, 100% critical paths
- **Performance:** Lighthouse CI (90+ enforced)

### Infrastructure

- **Package Manager:** pnpm 9+
- **Deployment:** Vercel (primary) + Docker (self-hosted option)
- **CI/CD:** GitHub Actions
- **Monitoring:** Sentry + Plausible + Axiom

---

## ğŸ“‚ Project Structure (Feature-Based)

**Architecture:** Feature-Based Structure (organized by business domain, not technical layers)

**Why:** Scalability. Each feature is autonomous, easy to find code, modify features without touching other modules, and allows team growth (each dev can work on a feature without conflicts).

```
rumbo/
â”œâ”€â”€ .claude/                 # Claude Code configuration
â”‚   â””â”€â”€ RULEBOOK.md          # This file (PROJECT LAW)
â”œâ”€â”€ .rumbo/                  # Project documentation (DO NOT DELETE)
â”‚   â”œâ”€â”€ CODE_STANDARDS.md    # â­ CODE STRUCTURE & BEST PRACTICES (MANDATORY)
â”‚   â”œâ”€â”€ TECH_STACK.md        # Complete tech stack details
â”‚   â”œâ”€â”€ TECHNICAL_REQUIREMENTS.md
â”‚   â”œâ”€â”€ PROJECT_DEFINITION.md
â”‚   â””â”€â”€ SCOPE.md
â”œâ”€â”€ app/                     # Next.js App Router (ROUTES ONLY)
â”‚   â”œâ”€â”€ (auth)/              # Auth layout group
â”‚   â”œâ”€â”€ (authenticated)/     # Main app layout group
â”‚   â””â”€â”€ api/trpc/[trpc]/     # tRPC endpoint
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ features/            # â­ FEATURE-BASED ORGANIZATION
â”‚   â”‚   â”œâ”€â”€ transactions/
â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”‚   â””â”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ budgets/
â”‚   â”‚   â”œâ”€â”€ bills/
â”‚   â”‚   â”œâ”€â”€ accounts/
â”‚   â”‚   â”œâ”€â”€ ai-chat/
â”‚   â”‚   â””â”€â”€ dashboard/
â”‚   â”œâ”€â”€ components/          # Shared components
â”‚   â”‚   â”œâ”€â”€ ui/              # Shadcn/ui (ALL in folders)
â”‚   â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â””â”€â”€ common/
â”‚   â”œâ”€â”€ server/              # Backend code
â”‚   â”‚   â”œâ”€â”€ api/routers/     # tRPC routers
â”‚   â”‚   â”œâ”€â”€ db/              # Prisma
â”‚   â”‚   â”œâ”€â”€ services/        # Business logic
â”‚   â”‚   â”œâ”€â”€ auth/            # NextAuth
â”‚   â”‚   â””â”€â”€ jobs/            # BullMQ
â”‚   â”œâ”€â”€ lib/                 # Shared utilities
â”‚   â”œâ”€â”€ hooks/               # Shared hooks
â”‚   â””â”€â”€ types/               # Shared types
â”œâ”€â”€ tests/e2e/               # Playwright E2E (centralized)
â”œâ”€â”€ docker/                  # Docker configs
â””â”€â”€ [config files]
```

**Key Principles:**

- `app/` is for **routes only** (pages, layouts, API routes)
- `src/features/` contains **ALL business logic** (components, hooks, types, utils per feature)
- `src/components/` contains **shared UI** (reusable across features)
- `src/server/` contains **backend code** (tRPC, services, jobs)
- **EVERY component is a folder** (no single-file components, ZERO exceptions)

---

## ğŸ“ CODE STANDARDS (Critical Rules)

**âš ï¸ CRITICAL: Read [.rumbo/CODE_STANDARDS.md](../.rumbo/CODE_STANDARDS.md) BEFORE writing ANY code**

This section highlights the most critical rules. **Full details in CODE_STANDARDS.md.**

### Strict Structure Rules (ZERO EXCEPTIONS)

**1. ALL components are folders (even simple ones like Button)**

```
âœ… CORRECT:
src/components/ui/button/
â”œâ”€â”€ index.tsx              # Component logic
â”œâ”€â”€ types.ts               # TypeScript types
â”œâ”€â”€ button.stories.tsx     # Storybook
â””â”€â”€ button.test.tsx        # Tests

âŒ WRONG:
src/components/ui/button.tsx  # Single-file NOT ALLOWED
```

**2. File naming: kebab-case ONLY**

```
âœ… CORRECT:
transaction-list/index.tsx
use-transactions/index.ts
format-currency.ts

âŒ WRONG:
TransactionList.tsx
useTransactions.ts
```

**3. Named exports ONLY (NO default exports)**

```typescript
// âœ… CORRECT
export function TransactionList() {}

// âŒ WRONG
export default function TransactionList() {}
```

**4. Explicit type imports**

```typescript
// âœ… CORRECT
import type { User } from '@/types';

// âŒ WRONG
import { User } from '@/types'; // Value import for types
```

**5. Strategic barrel exports (index.ts)**

- âœ… USE barrels: `components/ui/`, `lib/`, `types/`
- âŒ NO barrels: `features/` (kills tree-shaking)

**6. Path aliases: @/\* for everything**

```typescript
// âœ… CORRECT
import { Button } from '@/components/ui/button';
import { useTransactions } from '@/features/transactions/hooks/use-transactions';

// âŒ WRONG
import { Button } from '../../../components/ui/button';
```

**âš ï¸ EXCEPTION: Shadcn/ui Components**

`src/components/ui/` is the Shadcn/ui installation folder:
- âœ… Keep as single files (installed via `npx shadcn@latest add`)
- âŒ DO NOT refactor to folder structure
- âŒ DO NOT modify directly
- âœ… For customization: Create wrappers in `src/components/common/` or `src/features/*/components/`

**Full details:** [.rumbo/CODE_STANDARDS.md](../.rumbo/CODE_STANDARDS.md)

---

## ğŸ§ª Testing Strategy

**Target Coverage:**

- General: 80%+
- Critical paths: 100% (auth, transactions, AI, financial calculations)

**Test Organization:**

- **Unit/Integration:** Colocated (`.test.ts(x)` next to code)
- **Storybook:** Colocated (`.stories.tsx` next to components)
- **E2E:** Centralized (`tests/e2e/*.spec.ts`)

**Example:**

```
button/
â”œâ”€â”€ index.tsx
â”œâ”€â”€ types.ts
â”œâ”€â”€ button.test.tsx        âœ… Colocated
â””â”€â”€ button.stories.tsx     âœ… Colocated

tests/e2e/
â””â”€â”€ auth.spec.ts           âœ… Centralized
```

---

## ğŸ”’ Security Guidelines

**OWASP Top 10 Compliance (mandatory)**

**Critical Rules:**

1. **Input Validation:** Zod schemas on BOTH client AND server
2. **Authentication:** NextAuth.js 5 + Argon2 hashing
3. **Authorization:** Verify permissions on EVERY tRPC procedure
4. **SQL Injection:** Prisma handles this (NEVER raw SQL with user input)
5. **XSS Prevention:** React escapes by default, use DOMPurify for HTML
6. **CSRF Protection:** Next.js built-in
7. **Secrets:** Environment variables, NEVER commit to git
8. **HTTPS:** All production traffic over TLS
9. **Rate Limiting:** Implement on auth/AI endpoints
10. **Dependencies:** `pnpm audit` + Dependabot

---

## ğŸš€ Performance Targets

**Core Web Vitals:**

- **LCP:** < 2.5s
- **FID:** < 100ms
- **CLS:** < 0.1

**General:**

- **Page Load:** < 3s (mobile 4G)
- **Lighthouse Score:** 90+ (enforced by CI)
- **AI Response:** < 3s (streaming)

**Optimizations:**

- Server Components by default
- Lazy load Client Components
- Image optimization (`next/image`)
- Database indexes (userId, date, category)
- TanStack Query caching

---

## ğŸ¨ Design System

**Brand Identity:**

- **Primary Color:** Purple (oklch-based, trust & stability)
- **Typography:** Inter font family
- **Dark Mode:** Supported from day one
- **Mobile-First:** All designs start mobile

**Component Development:**

- **ALL components in Storybook**
- **Shadcn/ui base components**
- **Framer Motion animations** (respect `prefers-reduced-motion`)
- **WCAG 2.1 AA minimum**

---

## ğŸŒ Colombian Context

**Localization:**

- **Currency:** COP (Colombian Peso) - format: $1.234.567,89
- **Date:** DD/MM/YYYY (Colombian standard)
- **Language:** Spanish (es-CO) - Colombian Spanish
- **Timezone:** America/Bogota (UTC-5)

**Categories:**

```typescript
enum TransactionCategory {
  FOOD = 'AlimentaciÃ³n',
  TRANSPORT = 'Transporte',
  BILLS = 'Servicios',
  ENTERTAINMENT = 'Entretenimiento',
  HEALTH = 'Salud',
  EDUCATION = 'EducaciÃ³n',
  PERSONAL = 'Personal',
  DEBT = 'Deudas',
  SAVINGS = 'Ahorro',
  OTHER = 'Otros',
}
```

**Colombian Stores (v3):** Ã‰xito, Carulla, D1, Ara, OlÃ­mpica
**Colombian Banks (v5):** Bancolombia, Davivienda, Nequi, Daviplata

---

## ğŸ”„ Development Workflow

**Branch Strategy:**

- `main` - Production
- `develop` - Development
- `feature/*` - Features
- `bugfix/*` - Bug fixes
- `hotfix/*` - Emergency fixes

**Commit Convention (Conventional Commits):**

```
feat: Add AI chat component
fix: Resolve transaction date bug
docs: Update README
test: Add transaction tests
```

**PR Workflow:**

1. Create feature branch from `develop`
2. Run: lint, format, type-check, tests
3. Create PR to `develop`
4. **All CI checks must pass** (Lighthouse 90+, tests 80%, security audit)
5. Review and merge
6. Deploy `develop` to staging
7. Merge `develop` to `main` for production

---

## ğŸ† PRODUCTION-GRADE PHILOSOPHY (Zero Shortcuts)

**This project follows a "Zero Shortcuts" approach: Build it RIGHT from day one.**

### Core Principles

**1. Production-Grade from Day One**

- âœ… Full test coverage (80%+, 100% critical paths)
- âœ… CI/CD pipeline (automated tests, Lighthouse, security)
- âœ… Monitoring (Sentry, Plausible, Axiom)
- âœ… Performance budget (Lighthouse 90+ enforced)
- âœ… Accessibility (WCAG 2.1 AA)
- âœ… Security (OWASP Top 10)

**2. Beautiful by Design**

- âœ… Storybook for ALL components
- âœ… Design system with tokens
- âœ… Framer Motion animations
- âœ… Mobile-first, responsive
- âœ… Dark mode support

**3. Privacy-First**

- âœ… Self-hosted Postgres (Docker)
- âœ… User data ownership
- âœ… No Google Analytics (Plausible/Umami)
- âœ… GDPR compliant
- âœ… Self-hosted deployment option

**4. Feature-Complete for YOUR Use Case**

- âœ… All features YOU need working perfectly
- âœ… Not "functional" - POLISHED
- âœ… Colombian context (COP, stores, banks)
- âœ… AI that feels helpful

### CRITICAL RULES (NEVER BREAK)

1. **NEVER commit without tests** (80%+ coverage)
2. **NEVER skip CI/CD checks** (all must pass)
3. **NEVER use `any` type** (TypeScript strict mode)
4. **NEVER merge without review** (even solo)
5. **NEVER deploy without Lighthouse** (90+ score)
6. **NEVER skip accessibility** (WCAG 2.1 AA)
7. **NEVER trust user input** (Zod validation ALWAYS)
8. **NEVER store plaintext passwords** (Argon2 ALWAYS)
9. **NEVER break mobile** (mobile-first)
10. **NEVER take shortcuts** (build it right)

**This is not an MVP. This is production-ready from day one. ğŸ’ª**

---

## ğŸ“¦ Environment Variables

```env
# Database
DATABASE_URL="postgresql://..."

# Auth
NEXTAUTH_URL="http://localhost:3000"
NEXTAUTH_SECRET="generate-with-openssl-rand-base64-32"

# OpenAI
OPENAI_API_KEY="sk-..."

# Cloudflare R2
R2_ACCOUNT_ID=""
R2_ACCESS_KEY_ID=""
R2_SECRET_ACCESS_KEY=""
R2_BUCKET_NAME=""

# Redis
REDIS_URL="redis://localhost:6379"

# Email (Resend)
RESEND_API_KEY=""

# Monitoring
SENTRY_DSN=""
```

---

## ğŸ¯ Key Commands

```bash
# Development
pnpm dev                  # Start dev server
pnpm build                # Build for production
pnpm start                # Start production server
pnpm lint                 # ESLint
pnpm format               # Prettier
pnpm type-check           # TypeScript

# Database
pnpm prisma generate      # Generate Prisma client
pnpm prisma migrate dev   # Run migrations
pnpm prisma studio        # Prisma Studio
pnpm prisma db seed       # Seed database

# Testing
pnpm test                 # Vitest
pnpm test:watch           # Vitest watch
pnpm test:e2e             # Playwright E2E
pnpm test:coverage        # Coverage report

# Quality
pnpm check                # All checks (lint, format, type, test)

# Storybook
pnpm storybook            # Run Storybook
pnpm build-storybook      # Build Storybook
```

---

## ğŸ“š Documentation Hierarchy

### Project Documentation (`.rumbo/`)

1. **RULEBOOK.md** (this file) - Quick reference + links to detailed docs
2. **CODE_STANDARDS.md** - Complete code structure rules (MANDATORY reading)
3. **TECH_STACK.md** - Complete tech stack with rationale
4. **TECHNICAL_REQUIREMENTS.md** - Performance, security, accessibility
5. **SCOPE.md** - Roadmap, features, timeline
6. **PROJECT_DEFINITION.md** - Vision, mission, strategy

**All files in `.rumbo/` are the source of truth.**

### Claude/Maestro Documentation (`.claude/`)

7. **BRANCH_PROTECTION.md** - Git workflow and branch protection rules
8. **CURRENT_PLAN.md** - Temporal reference for active tasks (auto-generated, temporary)

### Public-Facing Documentation (`.github/`)

- **CONTRIBUTING.md** - Public contribution guidelines (referenced by GitHub)
- **CICD_SETUP.md** - CI/CD setup reference and troubleshooting

### Key Differences

- **`.rumbo/`** â†’ Project architecture, code standards, technical requirements
- **`.claude/`** â†’ Maestro-specific references, workflow rules, temporal plans
- **`.github/`** â†’ Public-facing docs that GitHub displays to contributors

---

## ğŸ¤– Active Agents

### Core Agents (Always Active)

- code-reviewer
- refactoring-specialist
- documentation-engineer
- test-strategist
- architecture-advisor
- security-auditor
- performance-optimizer
- git-workflow-specialist
- dependency-manager

### Stack-Specific Agents (Auto-Selected)

- nextjs-specialist
- react-specialist
- typescript-pro
- prisma-specialist
- postgres-expert
- tailwind-expert
- vitest-specialist
- playwright-e2e-specialist
- ai-integration-specialist
- auth-security-specialist

---

**Document Status:** âœ… Complete
**Generated by:** Maestro (Claude Code Agents Toolkit)
**Ready for:** Development kickoff ğŸš€

---

This RULEBOOK was auto-generated by scanning your project and documentation.

**To update this RULEBOOK:**

- Edit this file or reference documents directly
- Re-run Maestro - I'll read the latest version
- Validate changes with `claude-validate`

**For detailed code patterns, read:** `.rumbo/CODE_STANDARDS.md` â­
